# Function to generate the transition matrix for the repeat screen PT analysis
# 
# Takes coverage of PT in S, L and I and dimension of matrix as inputs 
# returns matrix

mat_gen <- function(covP_S,covP_L,covP_I,E,ER,A,R,dimension){

  mat_t <- c(
  # transitions from S
  (1-covP_S)*(1-A),covP_S*E,covP_S*(1-E)*(1-A),(1-covP_S)*A*Ld,(1-covP_S)*A*rev(td),0,0,0,covP_S*(1-E)*A*Ld,covP_S*(1-E)*A*rev(td),0,
  # transitions from S_on_P
  0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
  # transitions from S_P
  0,0,1-A,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,A*Ld,A*rev(td),0,
  # transitions from L
  0,0,0,(1-covP_L)*(1-(LtoL20+R*sum(td))),(1-covP_L)*(LtoL20+R*td[20]),(1-covP_L)*R*rev(td[1:19]),0,covP_L*E,0,covP_L*(1-E)*(1-(LtoL20+R*sum(td))),covP_L*(1-E)*(LtoL20+R*td[20]),covP_L*(1-E)*R*rev(td[1:19]),0,
  # transitions from L20
  0,0,0,0,0,1-covP_L,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,covP_L*E,0,0,0,covP_L*(1-E),0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
  # transitions from L19
  0,0,0,0,0,0,1-covP_L,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,covP_L*E,0,0,0,0,covP_L*(1-E),0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
  # transitions from L18
  0,0,0,0,0,0,0,1-covP_L,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,covP_L*E,0,0,0,0,0,covP_L*(1-E),0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
  # transitions from L17
  0,0,0,0,0,0,0,0,1-covP_L,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,covP_L*E,0,0,0,0,0,0,covP_L*(1-E),0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
  # transitions from L16
  0,0,0,0,0,0,0,0,0,1-covP_L,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,covP_L*E,0,0,0,0,0,0,0,covP_L*(1-E),0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
  # transitions from L15
  0,0,0,0,0,0,0,0,0,0,1-covP_L,0,0,0,0,0,0,0,0,0,0,0,0,0,0,covP_L*E,0,0,0,0,0,0,0,0,covP_L*(1-E),0,0,0,0,0,0,0,0,0,0,0,0,0,0,
  # transitions from L14
  0,0,0,0,0,0,0,0,0,0,0,1-covP_L,0,0,0,0,0,0,0,0,0,0,0,0,0,covP_L*E,0,0,0,0,0,0,0,0,0,covP_L*(1-E),0,0,0,0,0,0,0,0,0,0,0,0,0,
  # transitions from L13
  0,0,0,0,0,0,0,0,0,0,0,0,1-covP_L,0,0,0,0,0,0,0,0,0,0,0,0,covP_L*E,0,0,0,0,0,0,0,0,0,0,covP_L*(1-E),0,0,0,0,0,0,0,0,0,0,0,0,
  # transitions from L12
  0,0,0,0,0,0,0,0,0,0,0,0,0,1-covP_L,0,0,0,0,0,0,0,0,0,0,0,covP_L*E,0,0,0,0,0,0,0,0,0,0,0,covP_L*(1-E),0,0,0,0,0,0,0,0,0,0,0,
  # transitions from L11
  0,0,0,0,0,0,0,0,0,0,0,0,0,0,1-covP_L,0,0,0,0,0,0,0,0,0,0,covP_L*E,0,0,0,0,0,0,0,0,0,0,0,0,covP_L*(1-E),0,0,0,0,0,0,0,0,0,0,
  # transitions from L10
  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1-covP_L,0,0,0,0,0,0,0,0,0,covP_L*E,0,0,0,0,0,0,0,0,0,0,0,0,0,covP_L*(1-E),0,0,0,0,0,0,0,0,0,
  # transitions from L9
  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1-covP_L,0,0,0,0,0,0,0,0,covP_L*E,0,0,0,0,0,0,0,0,0,0,0,0,0,0,covP_L*(1-E),0,0,0,0,0,0,0,0,
  # transitions from L8
  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1-covP_L,0,0,0,0,0,0,0,covP_L*E,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,covP_L*(1-E),0,0,0,0,0,0,0,
  # transitions from L7
  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1-covP_L,0,0,0,0,0,0,covP_L*E,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,covP_L*(1-E),0,0,0,0,0,0,
  # transitions from L6
  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1-covP_L,0,0,0,0,0,covP_L*E,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,covP_L*(1-E),0,0,0,0,0,
  # transitions from L5
  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1-covP_I,0,0,0,0,covP_I*ER,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,covP_I*(1-ER),0,0,0,0,
  # transitions from L4
  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1-covP_I,0,0,0,covP_I*ER,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,covP_I*(1-ER),0,0,0,
  # transitions from L3
  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1-covP_I,0,0,covP_I*ER,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,covP_I*(1-ER),0,0,
  # transitions from L2
  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1-covP_I,0,covP_I*ER,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,covP_I*(1-ER),0,
  # transitions from L1
  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1-covP_I*ER,covP_I*ER,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
  # transitions from I - stay here for one cycle to be counted then move to had_TB
  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
  # transitions from on_P
  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
  # transitions from P
  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1-R,R*Ld,R*rev(td),0,
  # transitions from L_P
  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1-sum(LtoL20,R*sum(td)),LtoL20+R*td[20],R*rev(td[1:19]),0,
  # transitions from L20_P
  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
  # transitions from L19_P
  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
  # transitions from L18_P
  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
  # transitions from L17_P
  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
  # transitions from L16_P
  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
  # transitions from L15_P
  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
  # transitions from L14_P
  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,
  # transitions from L13_P
  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,
  # transitions from L12_P
  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,
  # transitions from L11_P
  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,
  # transitions from L10_P
  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,
  # transitions from L9_P
  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,
  # transitions from L8_P
  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,
  # transitions from L7_P
  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,
  # transitions from L6_P
  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,
  # transitions from L5_P
  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,
  # transitions from L4_P
  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,
  # transitions from L3_P
  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,
  # transitions from L2_P
  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,
  # transitions from L1_P
  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
  # transitions from had_TB
  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1)
  dim(mat_t) <- c(dimension,dimension)
  mat_t <- t(mat_t)
  return(mat_t)
}
